<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Chatbot</title>
  <style>
    body{
        font-family: 'Arial', sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
    }
    .chat-widget {
        width: 100%;
        max-width: 600px;
        height: 80vh;
        display: flex;
        flex-direction: column;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    header {
        text-align: center;
        padding: 15px;
        border-bottom: 1px solid #eee;
    }
    header h1 {
        margin: 0;
    }
    main#chat-container {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    footer {
        padding: 15px;
        border-top: 1px solid #eee;
    }
    #chat-form {
        display: flex;
        gap: 10px;
    }
    #message-input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
    }
    button {
        padding: 10px 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }
    button:disabled {
        background-color: #a0cfff;
        cursor: not-allowed;
    }
    /* Styles for message alignment */
    .user, .ai {
        display: flex;
        flex-direction: column;
    }
    .user {
        align-items: flex-end;
    }
    .ai {
        align-items: flex-start;
    }
    .ai.error .message-bubble {
        background-color: #f8d7da;
        color: #721c24;
    }
    .message-bubble {
        padding: 10px 15px;
        border-radius: 18px;
        max-width: 80%;
    }
    .user .message-bubble {
        background-color: #007bff;
        color: white;
    }
    .ai .message-bubble {
        background-color: #e9e9eb;
        color: black;
    }
  </style>
</head>
<body>
  <div class="chat-widget">

    <!-- Header -->
    <header>
      <h1>Yaswanth Dongara</h1>
    </header>

    <!-- Chat Container -->
    <main id="chat-container">
      <!-- Messages will be added here -->
    </main>

    <!-- Input Form -->
    <footer>
      <form id="chat-form">
        <input type="text" id="message-input" placeholder="Type your message..." autocomplete="off">
        <button type="submit">Send</button>
      </form>
    </footer>
  </div>

  <script>
    const chatForm = document.getElementById('chat-form');
    const messageInput = document.getElementById('message-input');
    const chatContainer = document.getElementById('chat-container');
    const submitButton = chatForm.querySelector('button[type="submit"]');

    let chatHistory = [];
    // WARNING: Exposing API keys in client-side code is not secure.
    let geminiApiKey = 'AIzaSyAbDTrPsmld91eG20PEGJl0wGV872naodM'; 

    document.addEventListener('DOMContentLoaded', () => {
      messageInput.disabled = false;
      submitButton.disabled = false;
      messageInput.placeholder = "Type your message...";
      chatContainer.innerHTML = '';
      appendMessage("Hello! I'm an AI assistant. How can I help you today?", 'ai');
      // It's good practice to set a persona for the AI.
      chatHistory = [{
        role: "model",
        parts: [{ text: "You are a helpful and friendly AI assistant." }]
      }];
    });

    chatForm.addEventListener('submit', handleFormSubmit);

    async function handleFormSubmit(e) {
      e.preventDefault();
      const userInput = messageInput.value.trim();
      if (!userInput) return;
      toggleForm(false);
      appendMessage(userInput, 'user');
      chatHistory.push({ role: "user", parts: [{ text: userInput }] });
      messageInput.value = '';
      const typingIndicator = showTypingIndicator();

      try {
        const aiResponse = await getAIResponse(chatHistory);
        chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
        typingIndicator.remove();
        appendMessage(aiResponse, 'ai');
      } catch (error) {
        console.error("Error fetching AI response:", error);
        typingIndicator.remove();
        appendMessage("An error occurred. Please check the console and ensure your API key is correct.", 'ai', true);
      } finally {
        toggleForm(true);
      }
    }

    async function getAIResponse(history) {
      if (!geminiApiKey) {
        throw new Error("API Key is not set.");
      }
      // CORRECTED: Added backticks (`) to create a template literal string.
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`;
      const payload = { contents: history };
      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        const errorBody = await response.text();
        // CORRECTED: Added backticks (`) to create a template literal string.
        throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorBody}`);
      }

      const result = await response.json();
      if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
        return result.candidates[0].content.parts[0].text;
      } else {
        console.warn("Unexpected API response structure:", result);
        if (result.error) {
          // CORRECTED: Added backticks (`) to create a template literal string.
          return `API Error: ${result.error.message}`;
        }
        return "I received an empty or invalid response from the AI.";
      }
    }

    function appendMessage(text, role, isError = false) {
      const messageWrapper = document.createElement('div');
      // Using classList for better class management
      messageWrapper.classList.add(role);

      const messageBubble = document.createElement('div');
      messageBubble.className = 'message-bubble';
      messageBubble.textContent = text;

      if (isError) {
        messageWrapper.classList.add('error');
      }

      messageWrapper.appendChild(messageBubble);
      chatContainer.appendChild(messageWrapper);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function showTypingIndicator() {
      const indicatorWrapper = document.createElement('div');
      indicatorWrapper.id = 'typing-indicator';
      indicatorWrapper.className = 'ai';
      
      const bubble = document.createElement('div');
      bubble.className = 'message-bubble';
      
      const dot1 = document.createElement('span');
      dot1.textContent = '.';
      const dot2 = document.createElement('span');
      dot2.textContent = '.';
      const dot3 = document.createElement('span');
      dot3.textContent = '.';
      
      bubble.append(dot1, dot2, dot3);
      indicatorWrapper.appendChild(bubble);
      chatContainer.appendChild(indicatorWrapper);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      return indicatorWrapper;
    }

    function toggleForm(isEnabled) {
      messageInput.disabled = !isEnabled;
      submitButton.disabled = !isEnabled;
      if (isEnabled) {
        messageInput.focus();
      }
    }
  </script>
</body>
</html>
